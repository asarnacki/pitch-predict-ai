# PitchPredict AI

A web application MVP for casual football fans that leverages AI to generate percentage-based match outcome predictions for Europe's top three leagues: Premier League, La Liga, and Bundesliga.

## Overview

PitchPredict AI addresses the problem of fragmented football statistics and complex analytical services by providing a simple, free tool that aggregates key data and presents quick, understandable predictions generated by AI models.

Users can:
- Browse upcoming matches from three major leagues
- Generate AI-powered predictions with probability distributions
- Save predictions with personal notes
- Track their prediction history
- Verify actual match results

## Tech Stack

### Frontend
- **Astro 5** - Static site generation with islands architecture
- **React 19** - Interactive components
- **TypeScript 5** - Type-safe development
- **Tailwind CSS 4** - Utility-first styling
- **Shadcn/ui** - Accessible component library

### Backend
- **Supabase** - PostgreSQL database, authentication, and Row Level Security
- **Astro API Routes** - Server-side endpoints

### AI Integration
- **OpenRouter.ai** - Access to Llama 3.1-70B for predictions

### Data Source
- **football-data.org** - Match data and statistics API

### Deployment
- **Cloudflare Pages** - Edge function hosting

## Getting Started

### Prerequisites

- Node.js 22.14.0 (see `.nvmrc`)
- npm package manager
- Supabase account and project
- OpenRouter.ai API key
- football-data.org API key

### Installation

1. Clone the repository:
```bash
git clone git@github.com:asarnacki/pitch-predict-ai.git
cd pitch-predict-ai
```

2. Install dependencies:
```bash
npm install
```

3. Set up environment variables:
```bash
cp .env.example .env
```

Configure the following variables:
```
SUPABASE_URL=your_supabase_url
SUPABASE_KEY=your_supabase_anon_key
OPENROUTER_API_KEY=your_openrouter_api_key
FOOTBALL_DATA_API_KEY=your_football_data_api_key
```

4. Start the development server:
```bash
npm run dev
```

5. Open http://localhost:3000 in your browser.

## Available Scripts

| Script | Description |
|--------|-------------|
| `npm run dev` | Start development server |
| `npm run build` | Build for production |
| `npm run preview` | Preview production build |
| `npm run lint` | Check code quality |
| `npm run lint:fix` | Auto-fix linting issues |
| `npm run format` | Format code with Prettier |
| `npm run test:unit` | Run unit tests (Vitest) |
| `npm run test:e2e` | Run E2E tests (Playwright) |

## Features

### Core Functionality

- **User Authentication** - Registration, login, logout, and password reset via Supabase Auth
- **Match Browsing** - View upcoming matches with league filtering (Premier League, La Liga, Bundesliga)
- **AI Predictions** - Generate probability distributions for home win, draw, and away win
- **Prediction Management** - Save up to 50 predictions per user with optional notes
- **Match Results** - Fetch actual results for completed matches

### Technical Features

- **API Caching** - 1-hour cache for match data, 6-hour cache for predictions
- **Row Level Security** - Database-level data isolation
- **Responsive Design** - Mobile-first approach (360px - 1440px+)
- **Dark/Light Mode** - Theme toggle with smooth transitions
- **Form Validation** - Client and server-side validation with Zod
- **Internationalization (i18n)** - UI translations stored in JSON locales (`pl` / `en`)

## Internationalization (i18n)

The app supports Polish and English UI via JSON locale files:

- `src/lib/i18n/locales/pl.json`
- `src/lib/i18n/locales/en.json`

Key points:

- **Type-safe translations**: the `Translation` type is inferred from the base locale JSON.
- **Language switcher**: implemented as a dropdown (`src/components/LanguageSwitcher.tsx`).
- **Astro islands compatibility**: language state is shared across islands via a module-level singleton store (not React Context across roots).
- **Stable E2E tests**: interactive React islands expose `data-hydrated="true"` once hydrated; Playwright waits for this attribute before interacting.

## API Endpoints

### Authentication
- `POST /api/auth/register` - Create new account
- `POST /api/auth/login` - Authenticate user
- `POST /api/auth/logout` - End session
- `POST /api/auth/reset-password` - Request password reset
- `POST /api/auth/update-password` - Set new password

### Data
- `GET /api/profile` - Get user profile
- `GET /api/matches?league={PL|PD|BL1}` - Fetch upcoming matches

### Predictions
- `POST /api/predictions/generate` - Generate AI prediction
- `GET /api/predictions` - List saved predictions (paginated)
- `POST /api/predictions` - Save prediction
- `GET /api/predictions/:id` - Get single prediction
- `PATCH /api/predictions/:id` - Update note
- `DELETE /api/predictions/:id` - Remove prediction
- `POST /api/predictions/:id/fetch-result` - Get match result

## Project Structure

```
src/
├── pages/           # Astro pages and API routes
│   ├── api/         # REST API endpoints
│   └── *.astro      # Page templates
├── components/      # React components
│   ├── hooks/       # Custom React hooks
│   └── ui/          # Shadcn/ui components
├── lib/             # Utilities and services
│   ├── services/    # Business logic
│   ├── validation/  # Zod schemas
│   └── errors/      # Error handling
├── db/              # Supabase configuration
├── layouts/         # Astro layouts
├── styles/          # Global CSS
└── types.ts         # Shared TypeScript types
```

## Documentation

Detailed documentation is available in the `.ai/` folder:

- `prd.md` - Product Requirements Document
- `tech-stack.md` - Technology decisions
- `db-plan.md` - Database schema and RLS policies
- `api-plan.md` - API specification
- `auth-spec.md` - Authentication architecture
- `test-plan.md` - Testing strategy

## Development Guidelines

- Follow TypeScript strict mode conventions
- Use Zod schemas for all request validation
- Handle errors with custom ApiError classes
- Sanitize user inputs to prevent XSS
- Maintain separation between services, hooks, and components

## License

This project is unlicensed. Contact the maintainers for licensing information.
